<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <title>taco-wasm</title>

    <style>
      body {
        width: 100vw;
        margin: 0;
        background-color: #f0f0f0;
      }

      .ui {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        width: 65vw;
        margin: auto;
        text-align: center;
      }

      #editor {
        height: 300px;
        width: 100%;
        padding: 5px;
      }

      #output {
        display: block;
        height: 300px;
        width: 100%;
        text-align: left;
        font-family: monospace;
        font-size: 16px;
        background-color: #000;
        color: #e1e1e1;
        padding: 5px;
      }

      button {
        padding: 15px 50px;
      }
    </style>
    <script type="importmap">
      {
        "imports": {
          "ansi-up": "https://cdn.jsdelivr.net/npm/ansi_up@6.0.6/ansi_up.min.js"
        }
      }
    </script>
  </head>
  <body>
    <div class="ui">
      <h2>Taco language demo</h2>
      <div id="editor">println("Hello, Taco")</div>
      <p><button type="button" id="run">Run</button></p>
      <p><pre id="output"></pre></p>
    </div>

    <script src="https://unpkg.com/ace-builds@1.3.3/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script type="module">
      import init, { wasm_main } from "./pkg/taco.js";

      import { AnsiUp } from 'ansi-up';

      const up = new AnsiUp();

      const editor = ace.edit("editor");
      editor.setTheme("ace/theme/dracula");
      editor.setFontSize(16);
      editor.setPrintMarginColumn(-1);

      editor.session.setMode("ace/mode/text");
      const run = () => {
        const source = editor.getValue();
        const output = wasm_main(source);
        var html = up.ansi_to_html(output);
        document.getElementById("output").innerHTML = html;
      };

      init().then(() => {
        document.getElementById("run").addEventListener("click", run);
      });
    </script>
  </body>
</html>
