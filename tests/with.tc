
fun test_with_method_for_record() {
    rec Person(
        name: str
        email: str
    )

    old = Person(
        email: "foo@bar.com"
        name: "per"
    )

    new = old.with(email: "new@email.com")

    assert old.name == "per"
    assert old.email == "foo@bar.com"
    assert new.name == "per"
    assert new.email == "new@email.com"
}

fun test_with_method_for_tuple() {
    old = (
        email: "foo@bar.com"
        name: "per"
    )

    new = old.with(email: "new@email.com")

    assert old.name == "per"
    assert old.email == "foo@bar.com"
    assert new.name == "per"
    assert new.email == "new@email.com"
}

fun test_inner_tuple() {
    rec Message(msg: str, sender: (name: str, age: int))

    m = Message("foo", sender: ("per", 42))

    fun n(m: Message) { m.sender.name }

    assert n(m.with(sender: ("per", 42))) == "per"
    assert n(m.with(sender: (name: "per", age: 42))) == "per"
    assert n(m.with(sender: (age: 42, name: "per"))) == "per"
}

